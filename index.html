<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ê±´ê³  ì£¼ì‹ ëª¨ì˜íˆ¬ì (V30 - News Article Update)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Serif+KR:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .market-open { color: #16a34a; font-weight: 700; }
        .market-closed { color: #dc2626; font-weight: 700; }
        .price-up { color: #dc2626; } 
        .price-down { color: #2563eb; } 
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        .toast-exit { animation: fadeOut 0.3s ease-in forwards; }
        
        @keyframes newsFlash { 
            0% { background-color: #fff; } 
            50% { background-color: #fffbeb; } 
            100% { background-color: #fff; } 
        }
        .news-flash { animation: newsFlash 1s ease-in-out; }
        
        /* ê¸°ì‚¬ ë³¸ë¬¸ìš© í°íŠ¸ */
        .article-font { font-family: 'Noto Serif KR', serif; }
    </style>
</head>
<body class="text-gray-800">

    <div id="toast-container" class="fixed top-5 right-5 z-[100] flex flex-col space-y-3 w-80 pointer-events-none"></div>

    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-100">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-indigo-700 mb-2">ğŸ“ˆ ëŒ€ê±´ê³  ì£¼ì‹ ëª¨ì˜íˆ¬ì</h1>
                <p class="text-gray-500 text-sm">V30: ë‰´ìŠ¤ ì‹¬ì¸µ ë³´ë„ ì‹œìŠ¤í…œ</p>
            </div>
            
            <form id="login-form" class="space-y-5" onsubmit="return false;">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                    <input type="text" id="login-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="ì´ë¦„ ì…ë ¥" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">í•™êµ ì´ë©”ì¼ (ID)</label>
                    <input type="email" id="login-email" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="ì˜ˆ: id@pess.cnehs.kr" required>
                </div>
                <button id="login-btn" type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform hover:scale-[1.02] active:scale-[0.98]">
                    ë¡œê·¸ì¸ ë° ì ‘ì†
                </button>
            </form>
            
            <p id="login-msg" class="mt-4 text-center text-sm font-medium text-red-500 min-h-[20px]"></p>
            
            <div class="mt-6 pt-4 border-t border-gray-100 text-xs text-gray-400 text-center">
                <p>í•™êµ ë„ë©”ì¸(@pess.cnehs.kr) ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
                <p id="db-status" class="mt-2 font-bold text-orange-500">ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹œë„ ì¤‘...</p>
            </div>
        </div>
    </div>

    <div id="game-screen" class="hidden min-h-screen flex flex-col">
        <header class="bg-white shadow-sm sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold text-gray-800 hidden sm:block">ëª¨ì˜íˆ¬ì</h1>
                    <span id="market-status-badge" class="px-3 py-1 rounded-full text-xs font-bold bg-gray-100 text-gray-500">ì¥ ì¤€ë¹„ ì¤‘</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p id="user-name-display" class="text-sm font-bold text-gray-800">ì‚¬ìš©ì</p>
                        <p id="user-role-display" class="text-xs text-gray-500">í•™ìƒ</p>
                    </div>
                    <button onclick="logout()" class="text-xs text-gray-400 hover:text-red-500 underline">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </header>

        <main class="flex-grow max-w-7xl mx-auto w-full p-4 grid grid-cols-1 lg:grid-cols-12 gap-6">
            <section class="lg:col-span-4 space-y-4">
                <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-indigo-500">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">ë‚´ ìì‚° í˜„í™©</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <span class="text-gray-500 text-sm">ì´ í‰ê°€ ìì‚°</span>
                            <span id="total-asset" class="text-2xl font-bold text-gray-900">50,000,000</span>
                        </div>
                        <div class="flex justify-between items-end border-t pt-2">
                            <span class="text-gray-500 text-sm">ë³´ìœ  í˜„ê¸ˆ</span>
                            <span id="cash-balance" class="text-lg font-semibold text-gray-700">50,000,000</span>
                        </div>
                        <div class="flex justify-between items-end">
                            <span class="text-gray-500 text-sm">íˆ¬ì ì†ìµ</span>
                            <span id="total-profit" class="text-lg font-semibold text-gray-500">0 (0.00%)</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow p-6 h-[500px] flex flex-col">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</h2>
                    <div id="portfolio-list" class="flex-grow overflow-y-auto space-y-2 pr-2 scrollbar-hide">
                        <div class="text-center text-gray-400 py-10">ë³´ìœ  ì¤‘ì¸ ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                    </div>
                </div>
            </section>

            <section class="lg:col-span-8 space-y-6">
                <div class="bg-gray-800 text-white rounded-lg p-3 shadow flex items-center overflow-hidden">
                    <span class="bg-red-600 text-xs font-bold px-2 py-1 rounded mr-3 flex-shrink-0 animate-pulse">LIVE</span>
                    <div class="overflow-hidden relative w-full h-6">
                        <div id="news-ticker" class="absolute whitespace-nowrap">
                            ì¥ ì‹œì‘ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤...
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-5 max-h-96 overflow-y-auto custom-scrollbar">
                    <div class="flex justify-between items-center mb-3 border-b pb-2">
                        <h2 class="text-lg font-bold text-gray-700">ğŸ“° ì‹¤ì‹œê°„ ì‹œì¥ ë‰´ìŠ¤</h2>
                        <span class="text-[10px] text-gray-400">â€» ì£¼ìš” ë‰´ìŠ¤ë¥¼ í´ë¦­í•˜ë©´ ê¸°ì‚¬ ì „ë¬¸ì´ ë‚˜ì˜µë‹ˆë‹¤.</span>
                    </div>
                    <div id="news-feed-list" class="space-y-2 text-sm"></div>
                </div>

                <div class="bg-white rounded-xl shadow-lg flex flex-col h-[550px]">
                    <div class="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-xl">
                        <h2 class="text-lg font-bold text-gray-700">KOSPI ì£¼ìš” ì¢…ëª©</h2>
                        <span class="text-xs text-gray-500">* ì‹¤ì‹œê°„ ì‹œì„¸ ë°˜ì˜</span>
                    </div>
                    
                    <div class="grid grid-cols-12 gap-2 px-4 py-2 bg-gray-100 text-xs font-bold text-gray-500">
                        <div class="col-span-4">ì¢…ëª©ëª…</div>
                        <div class="col-span-3 text-right">í˜„ì¬ê°€</div>
                        <div class="col-span-3 text-right">ë“±ë½ë¥ </div>
                        <div class="col-span-2 text-center">ë¶„ì„/ì£¼ë¬¸</div>
                    </div>

                    <div id="stock-list" class="flex-grow overflow-y-auto divide-y divide-gray-100"></div>
                </div>
            </section>
        </main>

        <div id="admin-panel" class="hidden fixed bottom-4 right-4 bg-gray-900 text-white p-4 rounded-xl shadow-2xl z-50 opacity-90 hover:opacity-100 transition border-2 border-yellow-500 w-80 max-h-[80vh] flex flex-col">
            <h3 class="font-bold text-yellow-400 mb-3 text-center border-b border-gray-700 pb-2">ğŸ‘‘ ê´€ë¦¬ì ëª¨ë“œ (V30)</h3>
            
            <div class="flex-grow overflow-y-auto space-y-2 pr-1 scrollbar-hide text-xs">
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button onclick="adminFunc('start')" class="bg-green-600 hover:bg-green-700 py-2 rounded font-bold">â–¶ ê°œì¥</button>
                    <button onclick="adminFunc('stop')" class="bg-red-600 hover:bg-red-700 py-2 rounded font-bold">â›” ë§ˆê°</button>
                </div>

                <div class="mt-2 mb-4 pt-2 border-t border-gray-700">
                    <button onclick="openBigRanking()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-3 rounded shadow-lg transform transition hover:scale-105">
                        ğŸ“º ëŒ€í˜• ë­í‚¹íŒ ë„ìš°ê¸°
                    </button>
                </div>

                <div class="text-center text-gray-400 text-[10px] mb-1">- ìˆ˜ì—… ì‹œë‚˜ë¦¬ì˜¤ (ê¸°ì‚¬ ì†¡ì¶œ) -</div>
                
                <div class="grid grid-cols-2 gap-1">
                    <button onclick="runScenario(1)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">09:30 ì‚°íƒ€ë ë¦¬</button>
                    <button onclick="runScenario(2)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">10:00 ì°¨ìµì‹¤í˜„</button>
                    <button onclick="runScenario(3)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">10:30 í™˜ìœ¨ ìˆ˜í˜œ</button>
                    <button onclick="runScenario(4)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">11:00 ì–´ë‹ ì‹œì¦Œ</button>
                    <button onclick="runScenario(5)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">11:30 í™˜ìœ¨ í”¼í•´</button>
                    <button onclick="runScenario(6)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">12:00 ì ì‹¬ ê´€ë§</button>
                    <button onclick="runScenario(7)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">14:00 ì„±ì¥ì£¼ ë°˜ë“±</button>
                    <button onclick="runScenario(8)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">14:30 ì‹¤ì  ì í”„</button>
                    <button onclick="runScenario(9)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">15:00 ê¸°ê´€ í­ë§¤ìˆ˜</button>
                    <button onclick="runScenario(10)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">15:30 ë°°ë‹¹ì£¼ ê´€ë¦¬</button>
                    <button onclick="runScenario(11)" class="px-2 py-1 bg-gray-800 hover:bg-indigo-900 rounded text-left">16:00 ìœˆë„ìš° ë“œë ˆì‹±</button>
                </div>

                <div class="h-4 border-b border-gray-700 mb-2"></div>
                <button onclick="adminFunc('reset')" class="w-full bg-black border border-red-500 text-red-500 hover:bg-red-900 py-2 rounded">âš ï¸ ë°ì´í„° ì „ì²´ ì´ˆê¸°í™”</button>
            </div>
        </div>
    </div>

    <div id="trade-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all scale-100">
            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                <div>
                    <h3 id="modal-stock-name" class="text-xl font-bold text-gray-900">ì‚¼ì„±ì „ì</h3>
                    <span id="modal-stock-code" class="text-xs text-gray-500 bg-gray-200 px-2 py-0.5 rounded">005930</span>
                </div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 font-bold text-xl">âœ•</button>
            </div>

            <div class="p-6 overflow-y-auto max-h-[80vh]">
                <div class="mb-6">
                    <canvas id="stockChart" width="400" height="200"></canvas>
                </div>
                <div class="flex items-center justify-between mb-4">
                    <span class="text-sm text-gray-600">í˜„ì¬ê°€</span>
                    <span id="modal-price" class="text-3xl font-bold text-indigo-600">70,000</span>
                </div>
                <div class="flex mb-4 bg-gray-100 p-1 rounded-lg">
                    <button onclick="setTradeType('buy')" id="tab-buy" class="flex-1 py-2 rounded-md text-sm font-bold bg-white shadow text-red-600 transition">ë§¤ìˆ˜</button>
                    <button onclick="setTradeType('sell')" id="tab-sell" class="flex-1 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-blue-600 transition">ë§¤ë„</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">ìˆ˜ëŸ‰</label>
                        <div class="flex items-center">
                            <input type="number" id="trade-qty" value="1" min="1" class="flex-grow p-2 border border-gray-300 rounded-l-lg text-center focus:outline-none focus:border-indigo-500" oninput="calcTotal()">
                            <button onclick="setMaxQty()" class="px-3 py-2 bg-gray-200 text-xs font-bold text-gray-600 rounded-r-lg hover:bg-gray-300">ìµœëŒ€</button>
                        </div>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">ì£¼ë¬¸ ì´ì•¡</span>
                        <div id="trade-total" class="text-right">0ì›</div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-400">
                        <span>ê°€ìš© ìì‚°/ë³´ìœ </span>
                        <span id="available-asset">0ì›</span>
                    </div>
                </div>
                <button id="btn-execute" onclick="executeOrder()" class="w-full mt-6 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg shadow transition">
                    ë§¤ìˆ˜ ì£¼ë¬¸
                </button>
            </div>
        </div>
    </div>

    <div id="article-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden relative flex flex-col max-h-[90vh]">
            <div class="bg-gray-50 border-b-2 border-gray-800 p-6">
                <div class="flex justify-between items-start mb-2">
                    <span id="article-time" class="bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">ì†ë³´</span>
                    <button onclick="closeArticleModal()" class="text-gray-400 hover:text-black text-2xl font-bold">âœ•</button>
                </div>
                <h2 id="article-title" class="text-2xl font-black text-gray-900 leading-tight article-font">
                    ê¸°ì‚¬ ì œëª©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.
                </h2>
                <p class="text-gray-500 text-xs mt-2 text-right">ëŒ€ê±´ê²½ì œ | ê¹€íƒœì¤€ ê¸°ì</p>
            </div>
            
            <div class="p-8 overflow-y-auto article-font text-gray-800 leading-relaxed text-lg text-justify bg-white custom-scrollbar">
                <p id="article-content">
                    ë³¸ë¬¸ ë‚´ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.
                </p>
            </div>

            <div class="p-4 bg-gray-100 text-center border-t text-xs text-gray-500">
                Copyright â“’ ëŒ€ê±´ê³ ë“±í•™êµ ëª¨ì˜íˆ¬ì ì‹œìŠ¤í…œ All rights reserved.
            </div>
        </div>
    </div>

    <div id="big-ranking-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-[100] flex justify-center items-center backdrop-blur-sm">
        <div class="bg-white w-[90%] h-[90%] rounded-2xl shadow-2xl p-8 flex flex-col relative overflow-hidden">
            <div class="flex justify-between items-center border-b-4 border-indigo-500 pb-4 mb-4">
                <h1 class="text-4xl font-black text-gray-800 tracking-tight">ğŸ‘‘ ì‹¤ì‹œê°„ ë¶€ì ë­í‚¹ TOP 50</h1>
                <button onclick="closeBigRanking()" class="text-3xl font-bold text-gray-400 hover:text-red-500 transition">âœ• ë‹«ê¸°</button>
            </div>
            <div class="flex-1 overflow-y-auto pr-4 custom-scrollbar">
                <table class="w-full text-left border-collapse">
                    <thead class="sticky top-0 bg-white z-10 shadow-sm">
                        <tr class="text-xl text-gray-500 border-b-2 border-gray-200">
                            <th class="p-4 w-[15%]">ìˆœìœ„</th>
                            <th class="p-4 w-[45%]">ì´ë¦„</th>
                            <th class="p-4 w-[40%] text-right">ì´ ìì‚°</th>
                        </tr>
                    </thead>
                    <tbody id="big-ranking-list" class="text-2xl font-bold text-gray-700"></tbody>
                </table>
            </div>
            <div class="text-center text-gray-400 mt-4 text-lg">
                â€» ì‹¤ì‹œê°„ ë°ì´í„°ì…ë‹ˆë‹¤. (F11ì„ ëˆŒëŸ¬ ì „ì²´í™”ë©´ìœ¼ë¡œ ë³´ì—¬ì£¼ì„¸ìš”)
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, getDocs, updateDoc, onSnapshot, runTransaction, serverTimestamp, increment, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const manualConfig = {
            apiKey: "AIzaSyDrhxV67EB2a9ZsKOs6XCMDPCaPJorgEyw",
            authDomain: "ge-stock-project.firebaseapp.com",
            projectId: "ge-stock-project",
            storageBucket: "ge-stock-project.firebasestorage.app",
            messagingSenderId: "269147597454",
            appId: "1:269147597454:web:91a4e847bc6de3343f37df",
            measurementId: "G-WV45GCRSHL"
        };
        const appId = 'stock-school-sim';

        let app, db, auth;
        try {
            app = initializeApp(manualConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            document.getElementById('db-status').textContent = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì™„ë£Œ";
            document.getElementById('db-status').className = "mt-2 font-bold text-green-500";
        } catch(e) {
            document.getElementById('db-status').textContent = "ì„¤ì • ì˜¤ë¥˜: " + e.message;
            document.getElementById('db-status').className = "mt-2 font-bold text-red-500";
        }

        const VIRTUAL_MARKET_DEPTH = 500000; 
        const FEE_RATES = { buy: 0.0015, sell: 0.003 };
        const ADMIN_EMAIL = "poiujuy0014@pess.cnehs.kr";

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, type, duration) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; 
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        window.playSound = (type) => {
            if (type === 'buy') playTone(880, 'sine', 0.15); 
            else if (type === 'sell') playTone(440, 'triangle', 0.15); 
            else if (type === 'news_good') playTone(1200, 'sine', 0.3); 
            else if (type === 'news_bad') playTone(150, 'sawtooth', 0.4); 
            else if (type === 'news_normal') playTone(600, 'square', 0.1); 
            else if (type === 'news_forecast') playTone(800, 'sine', 0.5); 
            else if (type === 'error') playTone(200, 'sawtooth', 0.2); 
        };

        window.enableSound = () => { if(audioCtx.state === 'suspended') audioCtx.resume(); };

        const USERS_DB = [
            { name: "í•˜ë¯¸ê²½", email: "mk3324@pess.cnehs.kr" },
            { name: "ê¹€íƒœì¤€", email: "poiujuy0014@pess.cnehs.kr" }, 
            { name: "ê°•ì€ì„±", email: "rkd2022@pess.cnehs.kr" },
        ];

        const INITIAL_STOCKS = [
            { code: "005930", name: "ì‚¼ì„±ì „ì", sector: "IT", price: 110000 }, 
            { code: "000660", name: "SKí•˜ì´ë‹‰ìŠ¤", sector: "IT", price: 577000 },
            { code: "035420", name: "NAVER", sector: "Platform", price: 237000 }, 
            { code: "035720", name: "ì¹´ì¹´ì˜¤", sector: "Platform", price: 58700 },
            { code: "006400", name: "ì‚¼ì„±SDI", sector: "Battery", price: 283500 }, 
            { code: "011070", name: "LGì´ë…¸í…", sector: "IT", price: 278000 },
            { code: "005380", name: "í˜„ëŒ€ì°¨", sector: "Auto", price: 288500 }, 
            { code: "000270", name: "ê¸°ì•„", sector: "Auto", price: 120700 },
            { code: "373220", name: "LGì—ë„ˆì§€ì†”ë£¨ì…˜", sector: "Battery", price: 389500 }, 
            { code: "003670", name: "í¬ìŠ¤ì½”í“¨ì²˜ì— ", sector: "Battery", price: 196200 },
            { code: "012450", name: "í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤", sector: "Defense", price: 897000 }, 
            { code: "079550", name: "LIGë„¥ìŠ¤ì›", sector: "Defense", price: 416500 },
            { code: "042660", name: "í•œí™”ì˜¤ì…˜", sector: "Ship", price: 110700 }, 
            { code: "329180", name: "HDí˜„ëŒ€ì¤‘ê³µì—…", sector: "Ship", price: 516000 },
            { code: "010140", name: "ì‚¼ì„±ì¤‘ê³µì—…", sector: "Ship", price: 24950 }, 
            { code: "066570", name: "HDí˜„ëŒ€ë¯¸í¬", sector: "Ship", price: 223000 },
            { code: "005490", name: "POSCOí™€ë”©ìŠ¤", sector: "Steel", price: 306000 }, 
            { code: "004020", name: "í˜„ëŒ€ì œì² ", sector: "Steel", price: 30600 },
            { code: "004600", name: "ê³ ë ¤ì•„ì—°", sector: "Steel", price: 1384000 }, 
            { code: "051910", name: "LGí™”í•™", sector: "Chem", price: 348000 },
            { code: "096770", name: "SKì´ë…¸ë² ì´ì…˜", sector: "Chem", price: 106000 }, 
            { code: "011170", name: "ë¡¯ë°ì¼€ë¯¸ì¹¼", sector: "Chem", price: 73800 },
            { code: "009830", name: "í•œí™”ì†”ë£¨ì…˜", sector: "Chem", price: 27400 }, 
            { code: "105560", name: "KBê¸ˆìœµ", sector: "Finance", price: 125900 },
            { code: "055550", name: "ì‹ í•œì§€ì£¼", sector: "Finance", price: 78300 }, 
            { code: "000810", name: "ì‚¼ì„±í™”ì¬", sector: "Finance", price: 493500 },
            { code: "323410", name: "ì¹´ì¹´ì˜¤ë±…í¬", sector: "Finance", price: 21900 }, 
            { code: "207940", name: "ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤", sector: "Bio", price: 1731000 },
            { code: "068270", name: "ì…€íŠ¸ë¦¬ì˜¨", sector: "Bio", price: 183700 }, 
            { code: "000100", name: "ìœ í•œì–‘í–‰", sector: "Bio", price: 115800 },
            { code: "004170", name: "ì‹ ì„¸ê³„", sector: "Retail", price: 248000 }, 
            { code: "023530", name: "ë¡¯ë°ì‡¼í•‘", sector: "Retail", price: 74200 },
            { code: "097950", name: "CJì œì¼ì œë‹¹", sector: "Food", price: 210000 }, 
            { code: "352820", name: "HYBE", sector: "Enter", price: 310000 },
            { code: "035900", name: "JYP Ent.", sector: "Enter", price: 70200 }, 
            { code: "041510", name: "ì—ìŠ¤ì— ", sector: "Enter", price: 117500 },
            { code: "122870", name: "ì™€ì´ì§€ì—”í„°í…Œì¸ë¨¼íŠ¸", sector: "Enter", price: 63600 }
        ];

        const NEWS_TEMPLATES = {
            'Market': [
                { text: "ë¯¸êµ­ ì—°ì¤€, ê¸°ì¤€ê¸ˆë¦¬ ë™ê²° ë°œí‘œ... ì‹œì¥ ì „ë°˜ ì•ˆë„ ë ë¦¬", type: "good", impact: 0.03 },
                { text: "ê¸€ë¡œë²Œ ê²½ê¸° ì¹¨ì²´ ê³µí¬ í™•ì‚°, íˆ¬ì‹¬ ê¸‰ê²©íˆ ìœ„ì¶•", type: "bad", impact: -0.03 },
                { text: "ì •ë¶€, ì¦ì‹œ ë¶€ì–‘ ìœ„í•œ ë°¸ë¥˜ì—… í”„ë¡œê·¸ë¨ 2íƒ„ ë°œí‘œ", type: "good", impact: 0.02 },
                { text: "í™˜ìœ¨ ê¸‰ë“±(ì›í™” ì•½ì„¸)ìœ¼ë¡œ ì™¸êµ­ì¸ ëŒ€ëŸ‰ ë§¤ë„ì„¸ ì¶œí˜„", type: "bad", impact: -0.02 },
                { text: "êµ­ë¯¼ì—°ê¸ˆ, êµ­ë‚´ ì£¼ì‹ ë¹„ì¤‘ í™•ëŒ€ ê³„íš ë°œí‘œ", type: "good", impact: 0.02 },
                { text: "ì¤‘ë™ ì§€ì •í•™ì  ë¦¬ìŠ¤í¬ ê³ ì¡°... êµ­ì œ ìœ ê°€ ê¸‰ë“±", type: "bad", impact: -0.02 }
            ],
            'Default': [
                { text: "{name}, ì–´ë‹ ì„œí”„ë¼ì´ì¦ˆ(ê¹œì§ ì‹¤ì ) ë°œí‘œ", type: "good", impact: 0.05 },
                { text: "{name}, ì‹¤ì  ì‡¼í¬... ì¦ê¶Œê°€ ëª©í‘œ ì£¼ê°€ ì¤„í•˜í–¥", type: "bad", impact: -0.04 },
                { text: "{name}, ì™¸êµ­ì¸ 10ì¼ ì—°ì† ìˆœë§¤ìˆ˜ í–‰ì§„", type: "good", impact: 0.03 },
                { text: "{name}, ê²½ì˜ê¶Œ ë¶„ìŸ ì¡°ì§ì— ë‹¨ê¸° ê¸‰ë“±", type: "good", impact: 0.05 }
            ]
        };

        // ğŸŸ¢ V30: ê¸°ì‚¬ ì „ë¬¸ ë°ì´í„° (ì„ ìƒë‹˜ì´ ì œê³µí•œ ë‚´ìš©)
        const SCENARIO_DETAILS = {
            1: {
                title: "[ì†ë³´] â€œì‚°íƒ€ê°€ ì˜¨ë‹¤â€...ì‚¼ì„±ì „ì, í˜„ëŒ€ì°¨ ë“± ëŒ€í˜•ì£¼ ì£¼ë„ë¡œ ì½”ìŠ¤í”¼ â€˜ê°•ì„¸â€™",
                content: "ì—°ë§ ì¦ì‹œê°€ ì‚°íƒ€ ë ë¦¬ì— ëŒ€í•œ ê¸°ëŒ€ê°ìœ¼ë¡œ ëœ¨ê±°ì›Œì§„ ê°€ìš´ë° êµ­ë‚´ ì¦ì‹œë¥¼ ëŒ€í‘œí•˜ëŠ” ëŒ€í˜•ì£¼ 5ì¸ë°©ì´ ì‹œì¥ì˜ ìƒìŠ¹ì„¸ë¥¼ ê°•ë ¥í•˜ê²Œ ê²¬ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¼ì„±ì „ìì™€ skí•˜ì´ë‹‰ìŠ¤ëŠ” AIë°˜ë„ì²´ ìˆ˜ìš” ì§€ì†ì— í˜ì…ì–´ ì™¸êµ­ì¸ì˜ ì§‘ì¤‘ ë§¤ìˆ˜ì„¸ë¥¼ ë°›ìœ¼ë©° IT ëŒ€ì¥ì£¼ë¡œì„œì˜ ë©´ëª¨ë¥¼ ê³¼ì‹œì¤‘ì…ë‹ˆë‹¤. ì‹¤ì  í˜¸ì¡°ë¥¼ ë³´ì´ê³  ìˆëŠ” í˜„ëŒ€ì°¨ì™€ AIìˆ˜ìµí™”ê°€ ê°€ì‹œí™”ëœ NAVER ë˜í•œ ê²¬ê³ í•œ í€ë”ë©˜í„¸ì„ ë°”íƒ•ìœ¼ë¡œ ì£¼ê°€ ìƒí–¥ ê³¡ì„ ì„ ê·¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì— POSCOê°€ ì² ê°• ì—…í™©íšŒë³µê³¼ ì´ì°¨ì „ì§€ ì†Œì¬ ê°€ì¹˜ ì¬ë¶€ê°ìœ¼ë¡œ í˜ì„ ë³´íƒœë©°, ì—…ì¢…ë³„ ê³ ë¥¸ ìƒìŠ¹ì„¸ê°€ ë‚˜íƒ€ë‚˜ê³  ìˆìŠµë‹ˆë‹¤. ì „ë¬¸ê°€ë“¤ì€ ì£¼ìš” ê¸°ì—…ë“¤ì˜ ì‹¤ì  ëª¨ë©˜í…€ì´ í™•ì‹¤í•œ ë§Œí¼ ì´ë²ˆ ì—°ë§ ë ë¦¬ê°€ ë‚´ë…„ ì´ˆê¹Œì§€ ì´ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤ê³  ì „ë§í•˜ê³  ìˆìŠµë‹ˆë‹¤."
            },
            2: {
                title: "[ì†ë³´] \"ì°¨ìµ ì‹¤í˜„ ë§¤ë¬¼ì— ë°œëª©\"â€¦ ì£¼ìš” ëŒ€í˜•ì£¼, ì €í•­ì„  ë¶€ë”ªíˆë©° ì¤„í•˜ë½",
                content: "ì¥ ì´ˆë°˜ ê°•í•œ ìƒìŠ¹ì„¸ë¡œ ì¶œë°œí–ˆë˜ êµ­ë‚´ ì¦ì‹œê°€ ì£¼ìš” ì¢…ëª©ë“¤ì˜ â€˜ê¸°ìˆ ì  ì €í•­ì„ â€™ ëŒíŒŒ ì‹¤íŒ¨ì™€ í•¨ê»˜ ì°¨ìµ ì‹¤í˜„ ë§¤ë¬¼ì´ ìŸì•„ì§€ë©° í˜¼ì¡°ì„¸ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤. ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤ì™€ ì…€íŠ¸ë¦¬ì˜¨ ë“± ì œì•½, ë°”ì´ì˜¤ ëŒ€ì¥ì£¼ë“¤ì€ ê³ ì  ë¶€ê·¼ì˜ ê°•ë ¥í•œ ë§¤ë„ ë²½ì„ ë„˜ì§€ ëª»í•˜ê³  ë‹¨ê¸° ì´ìµì„ í™•ì •ì§€ìœ¼ë ¤ëŠ” ë¬¼ëŸ‰ì´ ì¶œí˜„í•˜ë©° í•˜ë½ ì „í™˜í–ˆìŠµë‹ˆë‹¤. ìë™ì°¨ ëŒ€í‘œì£¼ì¸ ê¸°ì•„ì™€ ITë¶€í’ˆì£¼ì¸ LGì´ë…¸í… ì—­ì‹œ ì¥ ì¤‘ ê¸‰ë“±ì— ë”°ë¥¸ í”¼ë¡œê°ì´ ëˆ„ì ë˜ë©´ì„œ ì¶”ê°€ ìƒìŠ¹ ë™ë ¥ì„ ì–»ì§€ ëª»í•œ ì±„ í•˜ë½í­ì„ í‚¤ìš°ê³  ìˆìŠµë‹ˆë‹¤. ìµœê·¼ ë°˜ë“±ì„ ì‹œë„í•˜ë˜ ì¹´ì¹´ì˜¤ ë˜í•œ ì‹¬ë¦¬ì  ì €í•­ì„ ì— ë¶€ë”ªíˆë©° ë‹¨ê¸° ë§¤ë„ì„¸ê°€ ìœ ì…ë˜ëŠ” ë“± ì „ë°˜ì ìœ¼ë¡œ â€˜ìƒê³ í•˜ì €â€™ì˜ íë¦„ì´ ëšœë ·í•˜ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤. ì „ë¬¸ê°€ë“¤ì€ â€œì¥ ì´ˆë°˜ ê³¼ì—´ ì–‘ìƒì„ ë³´ì¸ ì¢…ëª©ë“¤ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê¸°ìˆ ì  ì¡°ì •ì´ ì´ë¤„ì§€ê³  ìˆë‹¤â€ë©° â€œì„±ê¸‰í•œ ì¶”ê²© ë§¤ìˆ˜ë³´ë‹¤ëŠ” ì§€ì§€ì„  í™•ì¸ í›„ ì§„ì…í•˜ëŠ” ì‹ ì¤‘í•œ ì ‘ê·¼ì´ í•„ìš”í•˜ë‹¤â€ê³  ê°•ì¡°í–ˆìŠµë‹ˆë‹¤."
            },
            3: {
                title: "[ì†ë³´] â€ê³ í™˜ìœ¨ì´ íš¨ìâ€...í˜„ëŒ€ì°¨, ì‚¼ì„±ì „ì ë“± ìˆ˜ì¶œ ëŒ€í˜•ì£¼ ì¼ì œíˆ ê°•ì„¸",
                content: "ì›/ë‹¬ëŸ¬ í™˜ìœ¨ì´ ê°€íŒŒë¥´ê²Œ ìƒìŠ¹í•˜ë©° ìˆ˜ì¶œê¸°ì—…ë“¤ì˜ ê°€ê²© ê²½ìŸë ¥ê³¼ ì›í™” í™˜ì‚° ì´ìµì´ ì»¤ì§ˆ ê²ƒì´ë¼ëŠ” ê¸°ëŒ€ê°ì´ ì¦ì‹œë¥¼ ì£¼ë„í•˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ëŒ€ì°¨ëŠ” ê³ í™˜ìœ¨ ìˆ˜í˜œë¥¼ ì§ì ‘ì ìœ¼ë¡œ ëˆ„ë¦¬ëŠ” ëŒ€í‘œ ì—…ì¢…ìœ¼ë¡œì„œ ì™¸í™” ê²°ì œ ë¹„ì¤‘ì´ ë†’ì€ ë¶ë¯¸ ì‹œì¥ì˜ í˜¸ì¡°ì„¸ì™€ ë§ë¬¼ë ¤ ê°€íŒŒë¥¸ ì£¼ê°€ ìƒìŠ¹ì„ ê¸°ë¡ì¤‘ì…ë‹ˆë‹¤. ì‚¼ì„±ì „ì ì—­ì‹œ ë°˜ë„ì²´ ìˆ˜ì¶œ ëŒ€ê¸ˆ ìœ ì… ì‹œ í™˜ì°¨ìµì´ ë°œìƒí•˜ë©° ìˆ˜ìµì„±ì´ ê°œì„ ë  ê²ƒì´ë¼ëŠ” ì „ë§ì— ë§¤ìˆ˜ì„¸ê°€ ëª°ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ìˆ˜ì£¼ ì‚°ì—…ì¸ ì¡°ì„ ê³¼ ë°©ì‚° ë¶„ì•¼ì˜ HDí˜„ëŒ€ì¤‘ê³µì—…, ì‚¼ì„±ì¤‘ê³µì—…, í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤ ë“±ë„ ë‹¬ëŸ¬ ê²°ì œ ê¸°ë°˜ì˜ ê³„ì•½ íŠ¹ì„±ìƒ ê°•ë ¥í•œ í™˜ìœ¨ ìˆ˜í˜œì£¼ë¡œ ë¶€ê°ë˜ë©° ë™ë°˜ ì‹ ê³ ê°€ë¥¼ ê²½ì‹ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‹œì¥ ì „ë¬¸ê°€ë“¤ì€ ë‹¹ë¶„ê°„ ë‹¬ëŸ¬ ê°•ì„¸ ê¸°ì¡°ê°€ ìœ ì§€ë  ê²ƒìœ¼ë¡œ ë³´ì´ëŠ” ë§Œí¼ ë‚´ìˆ˜ì£¼ë³´ë‹¤ëŠ” ìˆ˜ì¶œ ì£¼ë„í˜• ëŒ€í˜•ì£¼ ì¤‘ì‹¬ì˜ ìš°ìƒí–¥ íë¦„ì´ ì§€ì†ë  ê²ƒì´ë¼ê³  ë¶„ì„í–ˆìŠµë‹ˆë‹¤."
            },
            4: {
                title: "[ì†ë³´] â€˜ì–´ë‹ ì‹œì¦Œâ€™ëŒì…â€¦ ì´ì°¨ì „ì§€, ì—ë„ˆì§€ ì—…ê³„, ì‹¤ì  í™•ì¸ í›„ ë°©í–¥ì„± ê²°ì •ë  ë“¯",
                content: "ë³¸ê²©ì ì¸ 4ë¶„ê¸° ì‹¤ì  ë°œí‘œ ì‹œì¦Œì´ ë‹¤ê°€ì˜¤ë©´ì„œ, êµ­ë‚´ ëŒ€í‘œ ë°°í„°ë¦¬ ë° ì—ë„ˆì§€ ê¸°ì—…ë“¤ì˜ ì„±ì í‘œì— ì‹œì¥ì˜ ëª¨ë“  ì´ëª©ì´ ì ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ì‚¼ì„±SDIì™€ LGí™”í•™ì€ ê¸€ë¡œë²Œ ì „ê¸°ì°¨ ìˆ˜ìš” ë‘”í™”(Chasm)ì™€ ì „ë°© ì‚°ì—…ì˜ ì¬ê³  ì¡°ì • ì—¬íŒŒê°€ ì‹¤ì œ ìˆ˜ìµì„±ì— ì–´ëŠ ì •ë„ ì˜í–¥ì„ ë¯¸ì³¤ì„ì§€ë¥¼ ë‘ê³  íˆ¬ììë“¤ì˜ ì‹ ì¤‘í•œ ê´€ë§ì„¸ê°€ ì´ì–´ì§€ëŠ” ë¶„ìœ„ê¸°ì…ë‹ˆë‹¤. ì–‘ê·¹ì¬ ë“± í•µì‹¬ ì†Œì¬ë¥¼ ê³µê¸‰í•˜ëŠ” í¬ìŠ¤ì½”í“¨ì²˜ì—  ì—­ì‹œ ë¦¬íŠ¬ ê°€ê²© ë³€ë™ì— ë”°ë¥¸ íŒê°€ ì˜í–¥ê¶Œì— ë†“ì—¬ ìˆì–´, ì´ë²ˆ ì‹¤ì  ë°œí‘œì—ì„œ í–¥í›„ ê°€ë™ë¥  íšŒë³µ ì‹œì ì„ ì¦ëª…í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•œ ê´€ê±´ì´ ë  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. SKì´ë…¸ë² ì´ì…˜ê³¼ í•œí™”ì†”ë£¨ì…˜ ë˜í•œ ì •ì œë§ˆì§„ ì¶”ì´ì™€ ê¸€ë¡œë²Œ ì‹ ì¬ìƒ ì—ë„ˆì§€ ì •ì±… ë³€í™”ë¼ëŠ” ë³€ìˆ˜ ì†ì— ë†“ì—¬ ìˆì–´, ì‹¤ì  ê°€ì´ë˜ìŠ¤(ì „ë§ì¹˜)ë¥¼ í™•ì¸í•˜ê¸° ì „ê¹Œì§€ëŠ” ì‹œì¥ì˜ ê²½ê³„ê°ì´ í•´ì†Œë˜ì§€ ì•ŠëŠ” ëª¨ìŠµì…ë‹ˆë‹¤. ì „ë¬¸ê°€ë“¤ì€ \"í˜„ì¬ëŠ” ì‹¤ì ì˜ ìˆ˜ì¹˜ ìì²´ë³´ë‹¤ ê¸°ì—…ë“¤ì´ ì œì‹œí•  ë¯¸ë˜ ì „ëµê³¼ ì—…í™© íšŒë³µì— ëŒ€í•œ í™•ì‹ ì´ ì‹œì¥ ì‹¬ë¦¬ë¥¼ ë˜ëŒë¦´ í•µì‹¬ ì—´ì‡ ê°€ ë  ê²ƒ\"ì´ë¼ê³  ë‚´ë‹¤ë´¤ìŠµë‹ˆë‹¤."
            },
            5: {
                title: "[ì†ë³´] â€ê³ í™˜ìœ¨ì— ì›ê°€ ë¶€ë‹´ ëˆˆë©ì´â€...ë‚´ìˆ˜, ìˆ˜ì… ê¸°ì—… ìˆ˜ìµì„± ì•…í™” ì¼ë¡œ",
                content: "ìµœê·¼ ì›/ë‹¬ëŸ¬ í™˜ìœ¨ì´ ê°€íŒŒë¥´ê²Œ ìƒìŠ¹í•˜ë©´ì„œ ì›ìì¬ ìˆ˜ì… ë¹„ì¤‘ì´ ë†’ì€ ë‚´ìˆ˜ê¸°ì—…ë“¤ì„ ì¤‘ì‹¬ìœ¼ë¡œ ìˆ˜ìµì„± ì•…í™”ì— ëŒ€í•œ ê²½ê³„ê°ì´ ìµœê³ ì¡°ì— ë‹¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. CJì œì¼ì œë‹¹ì€ êµ­ì œ ê³¡ë¬¼ê°€ ìƒìŠ¹ì— ê³ í™˜ìœ¨ íš¨ê³¼ê¹Œì§€ ë”í•´ì§€ë©° ì›ê°€ ë¶€ë‹´ì´ ê¸‰ì¦í•¨ì— ë”°ë¼ 4ë¶„ê¸° ì˜ì—…ì´ìµë¥  ìœ ì§€ë¥¼ ìœ„í•œ ë¹„ìƒ ê²½ì˜ ì²´ì œì— ëŒì…í•œ ê²ƒìœ¼ë¡œ ì•Œë ¤ì¡ŒìŠµë‹ˆë‹¤. í•´ì™¸ ëª…í’ˆ ë° ì§ìˆ˜ì… ìƒí’ˆ ë¹„ì¤‘ì´ í° ì‹ ì„¸ê³„ì™€ ë¡¯ë°ì‡¼í•‘ ë“± ìœ í†µ ì—…ê³„ ì—­ì‹œ ì›í™” ê°€ì¹˜í•˜ë½ì— ë”°ë¥¸ ìˆ˜ì… ë‹¨ê°€ ìƒìŠ¹ì´ ë§ˆì§„ìœ¨ ì €í•˜ë¡œ ì´ì–´ì§€ë©° ì£¼ê°€ í•˜ë°© ì••ë ¥ì„ ê°•í•˜ê²Œ ë°›ê³  ìˆìŠµë‹ˆë‹¤. ì›ë£Œ ì˜ì•½í’ˆì˜ ìƒë‹¹ìˆ˜ë¥¼ ìˆ˜ì…ì— ì˜ì¡´í•˜ëŠ” ìœ í•œì–‘í–‰ ë˜í•œ í™˜ì°¨ì† ë°œìƒ ìš°ë ¤ì™€ ë¹„ìš© ì¦ê°€ë¼ëŠ” ì´ì¤‘ê³ ë¥¼ ê²ªìœ¼ë©° íˆ¬ì ì‹¬ë¦¬ê°€ ê¸‰ê²©íˆ ìœ„ì¶•ë˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤. ì‹œì¥ ì „ë¬¸ìë“¤ì€ â€œìˆ˜ì¶œ ê¸°ì—…ë“¤ê³¼ ë‹¬ë¦¬ ë‚´ìˆ˜ ê¸°ì—…ë“¤ì€ í™˜ìœ¨ ìƒìŠ¹ë¶„ì„ ê°€ê²©ì— ì¦‰ê° ë°˜ì˜í•˜ê¸° ì–´ë ¤ì›Œ ë‹¹ë¶„ê°„ ì‹¤ì  ë¶€ì§„ì´ ë¶ˆê°€í”¼í•  ê²ƒâ€ì´ë¼ë©° íˆ¬ì ì£¼ì˜ë¥¼ ë‹¹ë¶€í–ˆìŠµë‹ˆë‹¤."
            },
            6: {
                title: "[ì†ë³´] \"ìˆ«ìì— ì§‘ì¤‘í•  ì‹œê°„\"â€¦ ê´€ë§ì„¸ ì† ê°€ì¹˜ í‰ê°€ êµ¬ê°„ ì§„ì…",
                content: "ì¥ ì´ˆë°˜ì˜ ì†Œë€ìŠ¤ëŸ¬ì›€ì´ ì§€ë‚˜ê³  ê±°ë˜ëŸ‰ì´ ê¸‰ê°í•˜ëŠ” ì •ì˜¤ì— ë“¤ì–´ì„œë©° ì‹œì¥ì€ ê¸°ì—…ì˜ ë³¸ì§ˆì  ê°€ì¹˜ë¥¼ ë©´ë°€íˆ ë”°ì ¸ë³´ëŠ” â€˜ê¸°ë³¸ì  ë¶„ì„â€™ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€í‘œì ì¸ ì €ì£¼ê°€ìˆœìì‚°ë¹„ìœ¨ ì¢…ëª©ì¸ KBê¸ˆìœµê³¼ ì‹ í•œì§€ì£¼ ê·¸ë¦¬ê³  ì‚¼ì„±í™”ì¬ ë“± ê¸ˆìœµì£¼ë“¤ì€ ë°°ë‹¹ ë§¤ë ¥ê³¼ ì´ìµ ì•ˆì •ì„ ì—ë„ ë¶ˆêµ¬í•˜ê³  ì¶”ê°€ ìƒìŠ¹ì„ ì´ëŒ ìƒˆë¡œìš´ ëª¨ë©˜í…€ì„ ê¸°ë‹¤ë¦¬ë©° ëšœë ·í•œ ë°©í–¥ì„± ì—†ì´ íš¡ë³´í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì „í†µì ì¸ ì‚°ì—…ì¬ ì¢…ëª©ì¸ ê³ ë ¤ì•„ì—°ê³¼ í˜„ëŒ€ì œì²  ì—­ì‹œ ì—…í™© íšŒë³µ ê¸°ëŒ€ê°ê³¼ ê¸€ë¡œë²Œ ì›ìì¬ ê°€ê²© ì‚¬ì‹œì—ì„œ ê°€ì¹˜ í‰ê°€ê°€ íŒ½íŒ½í•˜ê²Œ ë§ë¬¼ë¦¬ë©° ì£¼ê°€ê°€ ë°•ìŠ¤ê¶Œì— ê°‡íŒ ëª¨ìŠµì…ë‹ˆë‹¤. íˆ¬ììë“¤ì´ ì¥ ì´ˆë°˜ì˜ ì‹¬ë¦¬ì  ë™ìš”ë¥¼ ë’¤ë¡œí•˜ê³  ì¬ë¬´ì œí‘œì™€ ì‹¤ì  ì „ë§ì¹˜ ë“± ê¸°ì´ˆ ì²´ë ¥(í€ë”ë©˜íƒˆ)ì„ ì ê²€í•¨ì— ë”°ë¼ ì‹œì¥ ì „ë°˜ì˜ ë³€ë™ì„±ì€ ëˆˆì— ë„ê²Œ ì¤„ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤. ì¦ê¶Œì—…ê³„ ê´€ê³„ìëŠ” â€œì ì‹¬ì‹œê°„ì„ ê¸°ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” ì´ëŸ¬í•œ ì •ì²´ í˜„ìƒì€ íˆ¬ììë“¤ì´ ì˜¤í›„ ì¥ì˜ ë°©í–¥ì„±ì„ ê²°ì •í•˜ê¸° ì „ ê¸°ì—… ê°€ì¹˜ë¥¼ ì¬ì‚°ì •í•˜ëŠ” í•„ì—°ì ì¸ ê³¼ì •â€ì´ë¼ê³  ì„¤ëª…í–ˆìŠµë‹ˆë‹¤."
            },
            7: {
                title: "[ì†ë³´] â€ë˜ì§ˆ ì‚¬ëŒì€ ë‹¤ ë˜ì¡Œë‹¤â€...ì–‘ë„ì„¸ í­íƒ„ ëš«ê³  ë¹„ìƒí•˜ëŠ” â€˜ì„±ì¥ì£¼â€™",
                content: "ì—°ë§ ì¦ì‹œì˜ ìµœëŒ€ ì•…ì¬ë¡œ ê¼½íˆë˜ ëŒ€ì£¼ì£¼ ì–‘ë„ì„¸ íšŒí”¼ ë¬¼ëŸ‰ì´ ì˜¤ì „ ì¤‘ ëŒ€ê±° ì†Œí™”ë˜ë©´ì„œ ì–µëˆŒë ¤ ìˆë˜ ì„±ì¥ì£¼ë“¤ì´ ë¶„ë…¸ì˜ ë°˜ë“±ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ì„¸ê¸ˆë¶€ë‹´ì„ í”¼í•˜ê¸° ìœ„í•œ â€˜ìš¸ë©° ê²¨ìë¨¹ê¸°â€™ì‹ ë§¤ë„ì„¸ê°€ ì¼ë‹¨ë½ë˜ì ê·¸ê°„ ê¸°ì—… ê°€ì¹˜ ëŒ€ë¹„ ì§€ë‚˜ì¹˜ê²Œ í•˜ë½í–ˆë‹¤ëŠ” â€˜ë‚™í­ ê³¼ëŒ€â€™ì¸ì‹ì´ í™•ì‚°ë˜ë©° ì €ê°€ ë§¤ìˆ˜ì„¸ê°€ ë¬´ì„­ê²Œ ìœ ì…ë˜ê³  ìˆìŠµë‹ˆë‹¤. í”Œë«í¼ ëŒ€ì¥ì£¼ì¸ ì¹´ì¹´ì˜¤ì™€ NAVERëŠ” ë§¤ë„ í­í’ì„ ê²¬ëŒë‚´ê³  ê°•ë ¥í•œ ìš°ìƒí–¥ ê³¡ì„ ì„ ê·¸ë¦¬ë©° ì‹œì¥ì˜ ì£¼ë„ê¶Œì„ íƒˆí™˜í•˜ê³  ìˆìœ¼ë©° ì—”í„°ì£¼ì¸ JYP Entì™€ HYBE ì—­ì‹œ ìˆ˜ê¸‰ ë¶ˆê· í˜•ì´ í•´ì†Œë¨ê³¼ ë™ì‹œì— ê°€íŒŒë¥¸ íƒ„ë ¥ì„ ë°›ìœ¼ë©° ê¸‰ë“±ì„¸ë¥¼ ì—°ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ê¸ˆìœµ í˜ì‹ ì˜ ì•„ì´ì½˜ì¸ ì¹´ì¹´ì˜¤ë±…í¬ë§ˆì € ê·¸ê°„ì˜ ë¶€ì§„ì„ í„¸ì–´ë‚´ëŠ” ë°˜ë“±ì— ì„±ê³µí•˜ë©° ì‹œì¥ì—ì„œëŠ” â€œì—°ë§ ì„¸ê¸ˆ íšŒí”¼ìš© íˆ¬ë§¤ê°€ ì˜¤íˆë ¤ ìµœê³ ì˜ ë§¤ìˆ˜ ê¸°íšŒë¥¼ ì œê³µí–ˆë‹¤â€ëŠ” ë¶„ì„ì´ ì§€ë°°ì ì…ë‹ˆë‹¤. ì „ë¬¸ê°€ë“¤ì€ â€œì•…ì„± ë§¤ë¬¼ì´ ì‚¬ë¼ì§„ ë¹ˆìë¦¬ë¥¼ ê¸°ê´€ê³¼ ì™¸êµ­ì¸ì´ ë¹ ë¥´ê²Œ ì±„ìš°ê³  ìˆë‹¤â€ë©° â€œì„±ì¥ì£¼ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ í•œ ì—°ë§ â€˜ì‡¼íŠ¸ ì»¤ë²„ë§(ê³µë§¤ë„ í™˜ë§¤ìˆ˜)â€™ ë ë¦¬ê°€ ë”ìš± ê±°ì„¸ì§ˆ ê²ƒâ€ ì´ë¼ê³  ê²½ê³  ì„ì¸ ì „ë§ì„ ë‚´ë†“ì•˜ìŠµë‹ˆë‹¤."
            },
            8: {
                title: "[ì†ë³´] \"ì„±ì¥ì˜ í•œê³„ëŠ” ì—†ë‹¤\"â€¦ ì£¼ìš” ëŒ€ê¸°ì—…, ì••ë„ì  ì‹¤ì  ì•ì„¸ì›Œ 'í€€í…€ ì í”„' ì˜ˆê³ ",
                content: "êµ­ë‚´ ì£¼ìš” ì‚°ì—…ì„ ì´ë„ëŠ” í•µì‹¬ ê¸°ì—…ë“¤ì´ ì‡ë”°ë¼ 'ì–´ë‹ ì„œí”„ë¼ì´ì¦ˆ'ë¥¼ ê¸°ë¡í•˜ë©° ëŒ€í•œë¯¼êµ­ ê²½ì œì˜ ê±´ì¬í•¨ì„ ê³¼ì‹œí•˜ê³  ìˆìŠµë‹ˆë‹¤. LGì—ë„ˆì§€ì†”ë£¨ì…˜ì€ ì°¨ì„¸ëŒ€ ë°°í„°ë¦¬ ê¸°ìˆ ë ¥ê³¼ ê²¬ê³ í•œ ìˆ˜ì£¼ ì”ê³ ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—­ëŒ€ê¸‰ ì‹¤ì ì„ ë‹¬ì„±í–ˆìœ¼ë©°, ê¸€ë¡œë²Œ ì‹œì¥ ì§€ë°°ë ¥ì„ ë”ìš± ê³µê³ íˆ í•˜ë©° ê±°ì¹¨ì—†ëŠ” ì„±ì¥ì„¸ë¥¼ ì´ì–´ê°ˆ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ë°©ì‚°ê³¼ ì¡°ì„ ì˜ ì£¼ì—­ì¸ LIGë„¥ìŠ¤ì›, í•œí™”ì˜¤ì…˜, HDí˜„ëŒ€ë¯¸í¬ ì—­ì‹œ ì „ ì„¸ê³„ì ì¸ ìˆ˜ì£¼ í˜¸í™©ì— í˜ì…ì–´ ì‚¬ìƒ ìµœëŒ€ ê·œëª¨ì˜ ì´ìµì„ ì‹¤í˜„í•¨ê³¼ ë™ì‹œì—, í–¥í›„ ëª‡ ë…„ê°„ì˜ ë¨¹ê±°ë¦¬ë¥¼ ë¯¸ë¦¬ í™•ë³´í•˜ë©° ì¥ê¸°ì ì¸ ìš°ìƒí–¥ ê¶¤ë„ì— ì§„ì…í–ˆìŠµë‹ˆë‹¤. ì—”í„° ëŒ€ì¥ì£¼ ì—ìŠ¤ì—  ë˜í•œ ì•„í‹°ìŠ¤íŠ¸ë“¤ì˜ ê°•ë ¥í•œ ê¸€ë¡œë²Œ íŒ¬ë¤ê³¼ ì‹ ê·œ IPì˜ ì„±ê³µì ì¸ ì•ˆì°©ìœ¼ë¡œ ìˆ˜ìµì„±ì´ ê·¹ëŒ€í™”ë˜ë©° ì—”í„° ì‚°ì—…ì˜ ìƒˆë¡œìš´ í™©ê¸ˆê¸°ë¥¼ ì£¼ë„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‹œì¥ ì „ë¬¸ê°€ë“¤ì€ \"ë‹¨ìˆœí•œ ìˆ«ìë¥¼ ë„˜ì–´ ê¸°ì—…ë“¤ì˜ ë³¸ì§ˆì ì¸ ê¸°ì´ˆ ì²´ë ¥ì´ ê°•í™”ë˜ì—ˆë‹¤ëŠ” ì ì´ ê³ ë¬´ì \"ì´ë¼ë©°, \"í˜„ì¬ì˜ ì••ë„ì ì¸ ì„±ê³¼ê°€ í–¥í›„ ê¸°ì—… ê°€ì¹˜ë¥¼ í•œ ë‹¨ê³„ ë” ëŒì–´ì˜¬ë¦¬ëŠ” ê°•ë ¥í•œ ë°œíŒì´ ë  ê²ƒ\"ì´ë¼ê³  ì¼ì œíˆ ì¥ë°‹ë¹› ì „ë§ì„ ë‚´ë†“ì•˜ìŠµë‹ˆë‹¤."
            },
            9: {
                title: "[ì†ë³´] \"ì‚°íƒ€ì˜ ì—­ìŠµ\"â€¦ ì¥ ë§‰íŒ ê¸°ê´€ 'ë¬»ì§€ë§ˆ ë§¤ìˆ˜'ì— ëŒ€í˜•ì£¼ ëŒ€í­ë°œ",
                content: "ì¥ ë§ˆê°ì„ ë¶ˆê³¼ í•œ ì‹œê°„ ì•ë‘ê³  ì‹œì¥ì˜ ì˜êµ¬ì‹¬ì„ ë‹¨ë²ˆì— ë‚ ë ¤ë²„ë¦¬ëŠ” ê¸°ê´€ì˜ 'í­ê²©ê¸°'ê¸‰ ë§¤ìˆ˜ì„¸ê°€ ìœ ì…ë˜ë©°, ì½”ìŠ¤í”¼ ëŒ€ì¥ì£¼ë“¤ì´ ì¼ì œíˆ ìˆ˜ì§ ìƒìŠ¹í•˜ëŠ” ì§„í’ê²½ì´ ë²Œì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì—°ë§ ì‚°íƒ€ ë ë¦¬ì˜ ì‹¤ì¢…ì„ ìš°ë ¤í•˜ë˜ ëª©ì†Œë¦¬ëŠ” ìˆœì‹ê°„ì— ì‚¬ë¼ì¡Œê³ , ì‚¼ì„±ì „ìì™€ SKí•˜ì´ë‹‰ìŠ¤ëŠ” ë°˜ë„ì²´ ì—…í™©ì˜ ì¥ë°‹ë¹› ë¯¸ë˜ë¥¼ í™•ì‹ í•œ ê¸°ê´€ì˜ ì‹¹ì“¸ì´ ë§¤ìˆ˜ì— í˜ì…ì–´ ì¥ì¤‘ ê³ ì ì„ ë¬´ì„œìš´ ê¸°ì„¸ë¡œ ëŒíŒŒí•˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ëŒ€ì°¨ ì—­ì‹œ í™˜ìœ¨ ìˆ˜í˜œì™€ ì‹¤ì  ìì‹ ê°ì´ ë§ë¬¼ë¦¬ë©° ê¸°ê´€ì˜ ì§‘ì¤‘ íƒ€ê¹ƒì´ ë˜ì—ˆê³ , ë§ˆê° ì§ì „ ë§¤ìˆ˜ì„¸ê°€ ì ë¦¬ë©° ì£¼ê°€ íƒ„ë ¥ì´ ê·¹ëŒ€í™”ë˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤. ì² ê°•ê³¼ ë¹„ì² ê¸ˆì†ì˜ ê¸°ë‘¥ì¸ POSCOí™€ë”©ìŠ¤ì™€ ê³ ë ¤ì•„ì—° ë˜í•œ \"ì§€ê¸ˆì´ ì•„ë‹ˆë©´ ëª» ì‚°ë‹¤\"ëŠ” ì‹ì˜ ê³µê²©ì ì¸ ê¸°ê´€ ìˆ˜ê¸‰ì´ ìœ ì…ë˜ë©´ì„œ, ì „ê´‘íŒì„ ì˜¨í†µ ë¶‰ì€ìƒ‰ìœ¼ë¡œ ë¬¼ë“¤ì´ëŠ” ê´‘í’ì˜ ì£¼ì¸ê³µì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹œì¥ ê´€ê³„ìë“¤ì€ \"ê¸°ê´€ì´ ì¥ ë§‰íŒ ì§€ìˆ˜ ëŒ€í˜•ì£¼ë¥¼ ì´í† ë¡ ê°•í•˜ê²Œ ëŒì–´ì˜¬ë¦¬ëŠ” ê²ƒì€ ë‚´ë…„ ì´ˆ ì¥ì„¸ì— ëŒ€í•œ ê°•ë ¥í•œ í™•ì‹ ì´ ì„œì§€ ì•Šê³ ì„œëŠ” ë¶ˆê°€ëŠ¥í•œ ì¼\"ì´ë¼ë©°, \"ì˜¤ëŠ˜ì˜ ë¼ìŠ¤íŠ¸ ì•„ì›ŒëŠ” ë‹¨ìˆœí•œ ë°˜ë“±ì„ ë„˜ì–´ ì—­ëŒ€ê¸‰ ì—°ë§ ë ë¦¬ì˜ ì„œë§‰ì„ ì•Œë¦¬ëŠ” ì‹ í˜¸íƒ„\"ì´ë¼ê³  í¥ë¶„ì„ ê°ì¶”ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
            },
            10: {
                title: "[ì†ë³´] \"ì°¬ë°”ëŒ ë¶ˆë©´ ì—­ì‹œ ë°°ë‹¹ì£¼\"â€¦ ë§‰íŒ ì¢…ê°€ ê´€ë¦¬ ë§¤ìˆ˜ì„¸ì— 'í•¨ë°•ì›ƒìŒ'",
                content: "ë³¸ê²©ì ì¸ ì—°ë§ ë°°ë‹¹ë½ì¼ì„ ì•ë‘ê³  ë°°ë‹¹ ìˆ˜ìµì„ í™•ë³´í•˜ë ¤ëŠ” ê¸°ê´€ê³¼ ì™¸êµ­ì¸ì˜ 'ë§‰íŒ ìŠ¤í¼íŠ¸'ê°€ ì´ì–´ì§€ë©° ì£¼ìš” ê³ ë°°ë‹¹ì£¼ë“¤ì´ ì¼ì œíˆ ê°•ì„¸ë¡œ ì¥ì„ ë§ˆê°í–ˆìŠµë‹ˆë‹¤. ê¸ˆìœµ ëŒ€ì¥ì£¼ì¸ KBê¸ˆìœµê³¼ ì‹ í•œì§€ì£¼ëŠ” ì•ˆì •ì ì¸ ì´ìµ ì²´ë ¥ê³¼ ë†’ì€ ë°°ë‹¹ ì„±í–¥ì´ ë‹¤ì‹œ í•œë²ˆ ë¶€ê°ë˜ë©´ì„œ, ì¥ ë§ˆê° ì§ì „ê¹Œì§€ ì¢…ê°€ ê´€ë¦¬ë¥¼ ìœ„í•œ ëŒ€ê·œëª¨ í”„ë¡œê·¸ë¨ ë§¤ìˆ˜ì„¸ê°€ ìœ ì…ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¼ì„±í™”ì¬ ì—­ì‹œ ì—­ëŒ€ê¸‰ ì‹¤ì ì— ë”°ë¥¸ ë°°ë‹¹ í™•ëŒ€ ê¸°ëŒ€ê°ì´ ì£¼ê°€ë¥¼ ë°€ì–´ ì˜¬ë ¸ìœ¼ë©°, ì „í†µì ì¸ ë°°ë‹¹ ê°•ìì¸ í˜„ëŒ€ì œì²  ë˜í•œ ì €í‰ê°€ ë§¤ë ¥ê³¼ ë°°ë‹¹ ë§¤ë ¥ì´ ë™ì‹œì— ë¶€ê°ë˜ë©° ê²¬ì¡°í•œ ìƒìŠ¹ì„¸ë¥¼ ìœ ì§€í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ê¸°ì•„ëŠ” ê°•ë ¥í•œ ì£¼ì£¼ í™˜ì› ì •ì±…ê³¼ ì‹¤ì  í˜¸ì¡°ê°€ ë§ë¬¼ë¦¬ë©° ë°°ë‹¹ì£¼ë¥¼ ì°¾ëŠ” íˆ¬ììë“¤ì˜ 'ì›í”½'ìœ¼ë¡œ ê¼½í˜€, ì¥ ë§‰íŒê¹Œì§€ ë§¤ìˆ˜ ìš°ìœ„ì˜ íë¦„ì„ ë³´ì˜€ìŠµë‹ˆë‹¤. ì¦ê¶Œì—…ê³„ì—ì„œëŠ” \"ì°¬ë°”ëŒì´ ë¶ˆê¸° ì‹œì‘í•˜ë©´ ë°°ë‹¹ì£¼ë¡œ ëª°ë¦¬ëŠ” ìˆ˜ê¸‰ì˜ ë²•ì¹™ì´ ì˜¬í•´ë„ ì¦ëª…ë˜ì—ˆë‹¤\"ë©° \"ì•ˆì •ì ì¸ ë°°ë‹¹ ìˆ˜ìµê³¼ ì£¼ê°€ ìƒìŠ¹ì´ë¼ëŠ” ë‘ ë§ˆë¦¬ í† ë¼ë¥¼ ì¡ìœ¼ë ¤ëŠ” ìŠ¤ë§ˆíŠ¸ ë¨¸ë‹ˆì˜ ì´ë™ì´ ëšœë ·í•˜ë‹¤\"ê³  ë¶„ì„í–ˆìŠµë‹ˆë‹¤."
            },
            11: {
                title: "[ì†ë³´] \"ì‹œì¥ì˜ ê´‘ê¸°, ë¸Œë ˆì´í¬ê°€ ì—†ë‹¤\"â€¦ ê¸°ê´€ë“¤ì˜ ì²˜ì ˆí•œ 'ìœˆë„ìš° ë“œë ˆì‹±'ì— ì¦ì‹œ í­ë°œ",
                content: "ì—°ë§ ìˆ˜ìµë¥  ì„±ì í‘œë¥¼ ë°›ì•„ë“¤ê¸° ì§ì „, ê¸°ê´€ íˆ¬ììë“¤ì´ ìˆ˜ë‹¨ê³¼ ë°©ë²•ì„ ê°€ë¦¬ì§€ ì•Šê³  ì£¼ê°€ë¥¼ ëŒì–´ì˜¬ë¦¬ëŠ” ì´ë¥¸ë°” 'ìœˆë„ìš° ë“œë ˆì‹±' ì‘ì „ì— ëŒì…í•˜ë©° ì‹œì¥ì´ í†µì œ ë¶ˆëŠ¥ì˜ ê´‘í’ ì†ìœ¼ë¡œ ë¹¨ë ¤ ë“¤ì–´ê°€ê³  ìˆìŠµë‹ˆë‹¤. ì‚¼ì„±ì „ìì™€ í˜„ëŒ€ì°¨ ë“± ì§€ìˆ˜ ëŒ€ì¥ì£¼ë“¤ì€ ê¸°ê´€ë“¤ì˜ ì²˜ì ˆí•œ 'ë¬¼ëŸ‰ ì“¸ì–´ë‹´ê¸°'ì— í˜ì…ì–´ ì „ê³ ì ì„ í˜ì—†ì´ íŒŒê´´í•˜ë©° ìˆ˜ì§ ìƒìŠ¹ ì¤‘ì´ë©°, ì „ê´‘íŒì€ ì˜¤ì§ ë¶‰ì€ìƒ‰ ìˆ«ìë¡œë§Œ ë„ë°°ë˜ëŠ” ê²½ì´ë¡œìš´ ê´‘ê²½ì´ í¼ì³ì§€ê³  ìˆìŠµë‹ˆë‹¤. ê¸ˆìœµì˜ í•µ KBê¸ˆìœµê³¼ ë°”ì´ì˜¤ ê±°ë¬¼ ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤ ì—­ì‹œ ìˆ˜ìµë¥  ê·¹ëŒ€í™”ë¥¼ ë…¸ë¦° ê¸°ê´€ì˜ ë¬´ì°¨ë³„ì ì¸ 'ë¬»ì§€ë§ˆ ë§¤ìˆ˜'ì— ì§ë©´í•˜ë©°, ìƒì‹ì ì¸ ë¶„ì„ì„ ë›°ì–´ë„˜ëŠ” í­ë°œì  ì‹œì„¸ë¥¼ ë¶„ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì² ê°•ì™• POSCOí™€ë”©ìŠ¤ì™€ í”Œë«í¼ì˜ ìƒì§• NAVERë§ˆì € ê¸°ê´€ë“¤ì˜ 'ìˆ˜ìµë¥  ì„¸íƒ'ì„ ìœ„í•œ ë§ˆì§€ë§‰ í¼ì¦ë¡œ ì§€ëª©ë˜ì–´, ì¥ ë§ˆê° ì§ì „ê¹Œì§€ ê±°ì¹¨ì—†ëŠ” ë§¤ìˆ˜ í­ê²© ì†ì— ë™ë°˜ ì‹ ê³ ê°€ ê²½ì‹ ì´ë¼ëŠ” ì „ìœ¨ì˜ ë“œë¼ë§ˆë¥¼ ì¨ ë‚´ë ¤ê°€ê³  ìˆìŠµë‹ˆë‹¤. ì‹œì¥ ì „ë¬¸ê°€ë“¤ì€ \"ì´ê²ƒì€ íˆ¬ìê°€ ì•„ë‹ˆë¼ ì „ìŸì´ë‹¤\"ë¼ë©°, \"í€ë”ë©˜í„¸ì„ ì™„ì „íˆ ë¬´ì‹œí•œ ì±„ ì˜¤ì§ ì¥ë¶€ìƒ ìˆ˜ìµë¥ ì„ ë†’ì´ê¸° ìœ„í•œ ê¸°ê´€ë“¤ì˜ ê´‘ê¸° ì–´ë¦° 'ì¢…ê°€ ì¡°ì‘ê¸‰' ë§¤ìˆ˜ì„¸ê°€ ì˜¤ëŠ˜ ì¦ì‹œë¥¼ ì™„ì „íˆ ì§€ë°°í–ˆë‹¤\"ê³  í˜€ë¥¼ ë‚´ë‘˜ë €ìŠµë‹ˆë‹¤."
            }
        };

        const SCENARIOS_DATA = {
            1: { time: "ì˜¤ì „ 9:30", targets: ["005930", "000660", "005380", "035420", "005490"], delta: 0.18 },
            2: { time: "ì˜¤ì „ 10:00", targets: ["207940", "068270", "000270", "011070", "035720"], delta: -0.15 },
            3: { time: "ì˜¤ì „ 10:30", targets: ["005380", "005930", "329180", "012450", "010140"], delta: 0.15 },
            4: { time: "ì˜¤ì „ 11:00", targets: ["006400", "051910", "003670", "096770", "009830"], delta: -0.20 },
            5: { time: "ì˜¤ì „ 11:30", targets: ["097950", "004170", "023530", "000100"], delta: -0.12 },
            6: { time: "ì˜¤í›„ 12:00", targets: ["105560", "055550", "000810", "004600", "004020"], delta: 0.005 },
            7: { time: "ì˜¤í›„ 1:30", targets: ["035720", "035420", "035900", "352820", "323410"], delta: 0.20 },
            8: { time: "ì˜¤í›„ 2:00", targets: ["373220", "079550", "042660", "066570", "041510"], delta: -0.22 },
            9: { time: "ì˜¤í›„ 2:30", targets: ["005930", "000660", "005380", "005490", "004600"], delta: 0.18 },
            10: { time: "ì˜¤í›„ 3:00", targets: ["105560", "000810", "055550", "004020", "000270"], delta: 0.05 },
            11: { time: "ì˜¤í›„ 3:30", targets: ["005930", "005380", "105560", "207940", "005490", "035420"], delta: 0.10 }
        };

        let currentUser = null;
        let marketData = {}; 
        let userPortfolio = { cash: 50000000, holdings: {} };
        let tradeState = { type: 'buy', code: null };
        let gameState = { day: 1, isOpen: false, gameVersion: 0, time: "09:00" }; 
        let allUsersCache = []; 
        let chartInstance = null;

        window.showToast = (message, type = 'info') => {
            const container = document.getElementById('toast-container');
            const el = document.createElement('div');
            let bgClass = "bg-blue-600";
            if(type === 'success') bgClass = "bg-green-600";
            if(type === 'error') bgClass = "bg-red-600";
            if(type === 'warning') bgClass = "bg-orange-500";
            if(type === 'forecast') bgClass = "bg-purple-600"; 

            el.className = `toast-enter transform transition-all duration-300 pointer-events-auto flex items-center p-4 rounded-lg shadow-lg text-white ${bgClass}`;
            let icon = "â„¹ï¸";
            if(type === 'success') icon = "âœ…";
            if(type === 'error') icon = "âš ï¸";
            if(type === 'warning') icon = "ğŸ””";
            if(type === 'forecast') icon = "ğŸ”®";

            el.innerHTML = `<span class="text-xl mr-3">${icon}</span><span class="font-medium text-sm">${message}</span>`;
            container.appendChild(el);
            
            setTimeout(() => {
                el.classList.remove('toast-enter');
                el.classList.add('toast-exit');
                setTimeout(() => el.remove(), 300);
            }, 3000);
        };

        function startAutoNewsLoop() {
            if (!currentUser || currentUser.role !== 'admin') return;
            const minDelay = 45000;
            const maxDelay = 60000;
            const delay = Math.floor(Math.random() * (maxDelay - minDelay + 1)) + minDelay;
            setTimeout(async () => {
                if (gameState.isOpen) {
                    await triggerRandomNews();
                }
                startAutoNewsLoop();
            }, delay);
        }

        async function login(e) {
            e.preventDefault(); 
            window.enableSound(); 
            const name = document.getElementById('login-name').value.trim();
            const email = document.getElementById('login-email').value.trim().toLowerCase();
            let userRecord = USERS_DB.find(u => u.name === name && u.email === email);
            if (!userRecord) {
                if (email.endsWith('@pess.cnehs.kr') || email.endsWith('@nonsandaegeon.cnehs.kr')) {
                    userRecord = { name: name, email: email };
                } else if (email !== "test@school.kr") {
                    document.getElementById('login-msg').textContent = "í•™êµ ì´ë©”ì¼ì´ ì•„ë‹ˆê±°ë‚˜ ëª…ë‹¨ì— ì—†ìŠµë‹ˆë‹¤.";
                    return;
                }
            }
            let role = (email === ADMIN_EMAIL) ? 'admin' : 'student';
            try {
                if (!auth.currentUser) await signInAnonymously(auth);
                const docId = email.replace(/[^a-zA-Z0-9]/g, '_'); 
                const userRef = doc(db, `artifacts/${appId}/users`, docId);
                const snap = await getDoc(userRef);
                if (!snap.exists()) {
                    await setDoc(userRef, {
                        name: name, email: email, role: role,
                        cash: 50000000, holdings: {}, transactions: [],
                        totalAssets: 50000000, dataVersion: 0, lastUpdate: serverTimestamp()
                    });
                }
                currentUser = { uid: docId, name, email, role };
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                setupUI();
                startRealtimeSync();
                showToast(`í™˜ì˜í•©ë‹ˆë‹¤, ${name}ë‹˜!`, 'success');
                playSound('buy'); 

                if (role === 'admin') {
                    startAutoNewsLoop();
                }

            } catch (err) {
                console.error(err);
                document.getElementById('login-msg').textContent = "ë¡œê·¸ì¸ ì˜¤ë¥˜: " + err.message;
            }
        }

        window.logout = () => { auth.signOut(); location.reload(); };

        function startRealtimeSync() {
            const marketRef = doc(db, `artifacts/${appId}/public/market_state`);
            onSnapshot(marketRef, async (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    marketData = data.stocks || {};
                    gameState = { day: data.day || 1, isOpen: data.isOpen, gameVersion: data.gameVersion || 1, time: data.time || "09:00" };
                    await checkAndResetUserData(gameState.gameVersion);
                    updateMarketUI(); 
                } else if (currentUser.role === 'admin') {
                    initMarketData();
                }
            });
            const myRef = doc(db, `artifacts/${appId}/users`, currentUser.uid);
            onSnapshot(myRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    userPortfolio = { cash: data.cash, holdings: data.holdings || {} };
                    updatePortfolioUI();
                }
            });
            const newsRef = doc(db, `artifacts/${appId}/public/news`);
            onSnapshot(newsRef, (doc) => {
                if (doc.exists()) {
                    updateNewsUI(doc.data().items || []);
                }
            });
        }
        
        async function checkAndResetUserData(globalVersion) {
            const userRef = doc(db, `artifacts/${appId}/users`, currentUser.uid);
            const userSnap = await getDoc(userRef);
            if (userSnap.exists()) {
                const userData = userSnap.data();
                if ((userData.dataVersion || 0) < globalVersion) {
                    await setDoc(userRef, {
                        name: currentUser.name, email: currentUser.email, role: currentUser.role,
                        cash: 50000000, holdings: {}, transactions: [],
                        totalAssets: 50000000, dataVersion: globalVersion, lastUpdate: serverTimestamp()
                    });
                    showToast("ìƒˆ ê²Œì„ ì‹œì‘! ìì‚°ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", 'warning');
                }
            }
        }

        window.adminFunc = async (action) => {
            if (currentUser.role !== 'admin') { showToast("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 'error'); return; }
            const marketRef = doc(db, `artifacts/${appId}/public/market_state`);
            if (action === 'start') {
                await updateDoc(marketRef, { isOpen: true });
                showToast("ì‹œì¥ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!", 'success');
            } else if (action === 'stop' || action === 'close') {
                await updateDoc(marketRef, { isOpen: false });
                showToast("ì¥ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.", 'info');
            } else if (action === 'reset') {
                if(confirm("ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) await resetGameGlobal();
            }
        };

        async function triggerRandomNews() {
            if (currentUser.role !== 'admin') return;

            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour12: false, hour: "2-digit", minute: "2-digit", second: "2-digit" });
            const codes = Object.keys(marketData);
            if(codes.length === 0) return;
            const isMarketEvent = Math.random() < 0.2; 
            let selectedCodes = [];
            let newsText = "";
            let impactRate = 0;
            let newsType = "normal";
            const updates = {}; 

            if (isMarketEvent) {
                const templateList = NEWS_TEMPLATES['Market'];
                const template = templateList[Math.floor(Math.random() * templateList.length)];
                newsText = template.text;
                newsType = template.type;
                impactRate = template.impact;
                selectedCodes = codes; 
            } else {
                const mainCode = codes[Math.floor(Math.random() * codes.length)];
                const mainStock = marketData[mainCode];
                const sector = mainStock.sector;
                const templateList = NEWS_TEMPLATES['Default'];
                const template = templateList[Math.floor(Math.random() * templateList.length)];
                newsText = template.text.replace("{name}", mainStock.name);
                newsType = template.type;
                impactRate = template.impact;
                selectedCodes = codes.filter(c => marketData[c].sector === sector);
            }

            selectedCodes.forEach(code => {
                const stock = marketData[code];
                let localImpact = impactRate;
                if (!isMarketEvent && newsText.includes(stock.name)) {
                    localImpact = impactRate * (0.9 + Math.random() * 0.3); 
                } else if (!isMarketEvent) {
                    localImpact = impactRate * 0.3 * (0.5 + Math.random() * 1.0); 
                } else {
                    localImpact = impactRate * (0.8 + Math.random() * 0.4);
                }
                let newPrice = Math.round(stock.price * (1 + localImpact));
                if (newPrice < 1) newPrice = 1;
                let history = stock.history || [];
                history.push(newPrice);
                if (history.length > 30) history.shift();
                updates[`stocks.${code}.price`] = newPrice;
                updates[`stocks.${code}.change`] = newPrice - stock.basePrice;
                updates[`stocks.${code}.rate`] = ((newPrice - stock.basePrice) / stock.basePrice) * 100;
                updates[`stocks.${code}.history`] = history;
            });

            const newsRef = doc(db, `artifacts/${appId}/public/news`);
            const newsSnap = await getDoc(newsRef);
            let currentNews = newsSnap.exists() ? newsSnap.data().items : [];
            const newEvent = { time: timeString, text: newsText, type: newsType };
            const newNewsList = [newEvent, ...currentNews].slice(0, 20);
            await updateDoc(newsRef, { items: newNewsList });
            const marketRef = doc(db, `artifacts/${appId}/public/market_state`);
            await updateDoc(marketRef, updates);
        }

        window.runScenario = async (scenarioId) => {
            if (currentUser.role !== 'admin') return;
            const scenario = SCENARIOS_DATA[scenarioId];
            const detail = SCENARIO_DETAILS[scenarioId]; // ğŸŸ¢ ê¸°ì‚¬ ë””í…Œì¼ ê°€ì ¸ì˜¤ê¸°
            if (!scenario) return;

            const newsRef = doc(db, `artifacts/${appId}/public/news`);
            const newsSnap = await getDoc(newsRef);
            let currentNews = newsSnap.exists() ? newsSnap.data().items : [];
            
            const newEvent = {
                time: scenario.time, 
                text: detail.title, // ğŸŸ¢ ì œëª©ì„ ë‰´ìŠ¤ í‹°ì»¤ìš©ìœ¼ë¡œ ì‚¬ìš©
                fullTitle: detail.title, // ğŸŸ¢ ëª¨ë‹¬ìš© ì „ì²´ ì œëª©
                fullContent: detail.content, // ğŸŸ¢ ëª¨ë‹¬ìš© ì „ì²´ ë³¸ë¬¸
                type: 'forecast' 
            };
            const newNewsList = [newEvent, ...currentNews].slice(0, 20);
            await updateDoc(newsRef, { items: newNewsList });
            showToast(`[ì „ì†¡] ${scenario.time} ê¸°ì‚¬ ì†¡ì¶œ ì™„ë£Œ. (5ë¶„ í›„ ì£¼ê°€ ë°˜ì˜)`, 'forecast');

            setTimeout(async () => {
                const updates = {};
                Object.keys(marketData).forEach(code => {
                    const stock = marketData[code];
                    let changePct = (Math.random() * 0.02) - 0.01; 
                    if (scenario.targets.includes('all')) {
                        changePct = scenario.delta * (0.9 + Math.random() * 0.2);
                    }
                    else if (scenario.targets.includes(code)) {
                        changePct = scenario.delta * (0.9 + Math.random() * 0.2); 
                    }
                    let newPrice = Math.round(stock.price * (1 + changePct));
                    if (newPrice < 1) newPrice = 1;
                    let history = stock.history || [];
                    history.push(newPrice);
                    if (history.length > 30) history.shift();
                    updates[`stocks.${code}.price`] = newPrice;
                    updates[`stocks.${code}.change`] = newPrice - stock.basePrice;
                    updates[`stocks.${code}.rate`] = ((newPrice - stock.basePrice) / stock.basePrice) * 100;
                    updates[`stocks.${code}.history`] = history;
                });
                const marketRef = doc(db, `artifacts/${appId}/public/market_state`);
                await updateDoc(marketRef, updates);
                showToast(`[ë°˜ì˜] ${scenario.time} ì‹œë‚˜ë¦¬ì˜¤ ì£¼ê°€ ë³€ë™ ì ìš©ë¨!`, 'warning');
            }, 300000); 
        };

        async function resetGameGlobal() {
            const initialData = {};
            INITIAL_STOCKS.forEach(s => {
                initialData[s.code] = {
                    name: s.name, price: s.price, basePrice: s.price,
                    change: 0, rate: 0, sector: s.sector,
                    history: [s.price]
                };
            });
            await setDoc(doc(db, `artifacts/${appId}/public/market_state`), {
                day: 1, isOpen: false, stocks: initialData, gameVersion: increment(1), time: "09:00"
            }, { merge: true });
            setDoc(doc(db, `artifacts/${appId}/public/news`), { items: [] });
            showToast("ì „ì²´ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ.", 'warning');
        }

        async function initMarketData() {
            const initialData = {};
            INITIAL_STOCKS.forEach(s => {
                initialData[s.code] = {
                    name: s.name, price: s.price, basePrice: s.price,
                    change: 0, rate: 0, sector: s.sector,
                    history: [s.price]
                };
            });
            await setDoc(doc(db, `artifacts/${appId}/public/market_state`), {
                day: 1, isOpen: false, stocks: initialData, gameVersion: 1, time: "09:00"
            }, { merge: true });
        }

        window.openTradeModal = (code) => {
            if (!gameState.isOpen) {
                showToast("í˜„ì¬ ì¥ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ê±°ë˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
                return;
            }
            const stock = marketData[code];
            tradeState.code = code;
            tradeState.type = 'buy';
            document.getElementById('modal-stock-name').innerText = stock.name;
            document.getElementById('modal-stock-code').innerText = code;
            document.getElementById('trade-qty').value = 1;
            updateModalUI();
            document.getElementById('trade-modal').classList.remove('hidden');
            renderChart(stock.history || [stock.price], stock.name);
        };

        function renderChart(data, label) {
            const ctx = document.getElementById('stockChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: data.length}, (_, i) => i + 1),
                    datasets: [{ label: label + ' ì£¼ê°€', data: data, borderColor: '#4f46e5', backgroundColor: 'rgba(79, 70, 229, 0.1)', borderWidth: 2, tension: 0.3, fill: true, pointRadius: 0 }]
                },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { beginAtZero: false, grid: { display: true, color: '#f3f4f6' } } }, animation: { duration: 0 } }
            });
        }

        window.setTradeType = (type) => {
            tradeState.type = type;
            const btnBuy = document.getElementById('tab-buy');
            const btnSell = document.getElementById('tab-sell');
            const btnExec = document.getElementById('btn-execute');
            if (type === 'buy') {
                btnBuy.className = "flex-1 py-2 rounded-md text-sm font-bold bg-white shadow text-red-600 transition";
                btnSell.className = "flex-1 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-blue-600 transition";
                btnExec.className = "w-full mt-6 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg shadow transition";
                btnExec.innerText = "ë§¤ìˆ˜ ì£¼ë¬¸";
            } else {
                btnSell.className = "flex-1 py-2 rounded-md text-sm font-bold bg-white shadow text-blue-600 transition";
                btnBuy.className = "flex-1 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-red-600 transition";
                btnExec.className = "w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow transition";
                btnExec.innerText = "ë§¤ë„ ì£¼ë¬¸";
            }
            updateModalUI();
        };

        window.calcTotal = () => updateModalUI();

        function updateModalUI() {
            const stock = marketData[tradeState.code];
            const price = stock.price;
            const qty = parseInt(document.getElementById('trade-qty').value) || 0;
            const rawTotal = price * qty;
            const feeRate = tradeState.type === 'buy' ? FEE_RATES.buy : FEE_RATES.sell;
            const fee = Math.floor(rawTotal * feeRate);
            let finalTotal = 0;
            let feeText = "";
            if (tradeState.type === 'buy') {
                finalTotal = rawTotal + fee;
                feeText = `(ìˆ˜ìˆ˜ë£Œ ${fee.toLocaleString()}ì› í¬í•¨)`;
            } else {
                finalTotal = rawTotal - fee;
                feeText = `(ì„¸ê¸ˆ/ìˆ˜ìˆ˜ë£Œ ${fee.toLocaleString()}ì› ì°¨ê°)`;
            }
            document.getElementById('modal-price').innerText = price.toLocaleString();
            document.getElementById('trade-total').innerHTML = `${finalTotal.toLocaleString()}ì› <br><span class="text-xs text-gray-400 font-normal">${feeText}</span>`;
            const holdings = userPortfolio.holdings || {};
            const myHolding = holdings[tradeState.code] || { quantity: 0 };
            if (tradeState.type === 'buy') {
                document.getElementById('available-asset').innerText = "ê°€ìš©: " + userPortfolio.cash.toLocaleString() + "ì›";
            } else {
                document.getElementById('available-asset').innerText = "ë³´ìœ : " + myHolding.quantity + "ì£¼";
            }
        }

        window.setMaxQty = () => {
            const stock = marketData[tradeState.code];
            if (tradeState.type === 'buy') {
                const maxBuyable = Math.floor(userPortfolio.cash / (stock.price * (1 + FEE_RATES.buy)));
                document.getElementById('trade-qty').value = maxBuyable;
            } else {
                const holdings = userPortfolio.holdings || {};
                const holding = holdings[tradeState.code] || { quantity: 0 };
                document.getElementById('trade-qty').value = holding.quantity;
            }
            updateModalUI();
        }

        window.closeModal = () => document.getElementById('trade-modal').classList.add('hidden');

        window.executeOrder = async () => {
            if (!gameState.isOpen) {
                showToast("ì¥ì´ ë§ˆê°ë˜ì–´ ì£¼ë¬¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
                return;
            }
            const qty = parseInt(document.getElementById('trade-qty').value);
            if (qty <= 0) {
                showToast("ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.", 'warning');
                return;
            }
            const code = tradeState.code;
            const marketRef = doc(db, `artifacts/${appId}/public/market_state`);
            const userRef = doc(db, `artifacts/${appId}/users`, currentUser.uid);
            try {
                await runTransaction(db, async (transaction) => {
                    const marketDoc = await transaction.get(marketRef);
                    const userDoc = await transaction.get(userRef);
                    if (!marketDoc.exists() || !userDoc.exists()) throw "Data Error";
                    const marketState = marketDoc.data();
                    const userData = userDoc.data();
                    if (!marketState.isOpen) throw "Market Closed";
                    const stock = marketState.stocks[code];
                    const currentPrice = stock.price;
                    const rawAmount = currentPrice * qty;
                    let finalAmount = 0;
                    let newHoldings = { ...userData.holdings };
                    let newCash = userData.cash;
                    let stockHolding = newHoldings[code] ? { ...newHoldings[code] } : { quantity: 0, avgPrice: 0 };
                    if (tradeState.type === 'buy') {
                        const fee = Math.floor(rawAmount * FEE_RATES.buy);
                        finalAmount = rawAmount + fee;
                        if (newCash < finalAmount) throw "ì”ì•¡ ë¶€ì¡± (ìˆ˜ìˆ˜ë£Œ í¬í•¨)";
                        newCash -= finalAmount;
                        const newQty = stockHolding.quantity + qty;
                        stockHolding.avgPrice = Math.round(((stockHolding.quantity * stockHolding.avgPrice) + finalAmount) / newQty);
                        stockHolding.quantity = newQty;
                        newHoldings[code] = stockHolding;
                    } else {
                        if (stockHolding.quantity < qty) throw "ì£¼ì‹ ë¶€ì¡±";
                        const fee = Math.floor(rawAmount * FEE_RATES.sell);
                        finalAmount = rawAmount - fee;
                        newCash += finalAmount;
                        stockHolding.quantity -= qty;
                        if (stockHolding.quantity === 0) delete newHoldings[code];
                        else newHoldings[code] = stockHolding;
                    }
                    const direction = tradeState.type === 'buy' ? 1 : -1;
                    const priceImpactPct = (qty / VIRTUAL_MARKET_DEPTH) * direction;
                    let newMarketPrice = Math.round(currentPrice * (1 + priceImpactPct));
                    if (newMarketPrice < 1) newMarketPrice = 1;
                    let history = stock.history || [];
                    history.push(newMarketPrice);
                    if (history.length > 30) history.shift();
                    transaction.update(userRef, { cash: newCash, holdings: newHoldings });
                    const updates = {};
                    updates[`stocks.${code}.price`] = newMarketPrice;
                    updates[`stocks.${code}.change`] = newMarketPrice - stock.basePrice;
                    updates[`stocks.${code}.rate`] = ((newMarketPrice - stock.basePrice) / stock.basePrice) * 100;
                    updates[`stocks.${code}.history`] = history;
                    transaction.update(marketRef, updates);
                });
                if(tradeState.type === 'buy') playSound('buy');
                else playSound('sell');
                showToast("ì£¼ë¬¸ì´ ì²´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
                closeModal();
            } catch (e) {
                showToast("ì£¼ë¬¸ ì‹¤íŒ¨: " + e, 'error');
            }
        };

        function setupUI() {
            document.getElementById('user-name-display').innerText = currentUser.name;
            document.getElementById('user-role-display').innerText = currentUser.role === 'admin' ? 'ê´€ë¦¬ì(ì„ ìƒë‹˜)' : 'í•™ìƒ';
            if (currentUser.role === 'admin') document.getElementById('admin-panel').classList.remove('hidden');
        }

        function updateMarketUI() {
            const badge = document.getElementById('market-status-badge');
            if (gameState.isOpen) {
                badge.innerText = "ì‹œì¥ ì§„í–‰ ì¤‘";
                badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 animate-pulse";
            } else {
                badge.innerText = "ì¥ ë§ˆê°";
                badge.className = "px-3 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700";
            }
            const listEl = document.getElementById('stock-list');
            listEl.innerHTML = ''; 
            INITIAL_STOCKS.forEach(initStock => {
                const code = initStock.code;
                const s = marketData[code]; 
                if (!s) return; 
                const colorClass = s.rate > 0 ? 'price-up' : (s.rate < 0 ? 'price-down' : 'text-gray-500');
                const sign = s.rate > 0 ? 'â–²' : (s.rate < 0 ? 'â–¼' : '');
                const div = document.createElement('div');
                div.className = "grid grid-cols-12 gap-2 px-4 py-3 items-center hover:bg-gray-50 transition border-b border-gray-50";
                div.innerHTML = `<div class="col-span-4 font-medium text-gray-800">${s.name}<span class="block text-xs text-gray-400">${code}</span></div><div class="col-span-3 text-right font-bold ${colorClass}">${s.price.toLocaleString()}</div><div class="col-span-3 text-right text-xs ${colorClass}">${sign} ${s.rate.toFixed(2)}%</div><div class="col-span-2 text-center"><button onclick="openTradeModal('${code}')" class="bg-gray-100 hover:bg-indigo-100 text-indigo-600 px-3 py-1 rounded text-xs font-bold transition">ë¶„ì„/ì£¼ë¬¸</button></div>`;
                listEl.appendChild(div);
            });
        }

        function updatePortfolioUI() {
            let stockValuation = 0;
            const holdingsDiv = document.getElementById('portfolio-list');
            holdingsDiv.innerHTML = '';
            const holdings = userPortfolio.holdings || {};
            Object.keys(holdings).forEach(code => {
                const qty = holdings[code].quantity;
                const avg = holdings[code].avgPrice;
                const currentPrice = marketData[code]?.price || 0;
                const value = qty * currentPrice;
                stockValuation += value;
                const div = document.createElement('div');
                div.className = "flex justify-between items-center p-3 bg-gray-50 rounded-lg";
                div.innerHTML = `<div><p class="font-bold text-gray-800 text-sm">${marketData[code]?.name || code}</p><p class="text-xs text-gray-500">${qty}ì£¼ (í‰ë‹¨ ${avg.toLocaleString()})</p></div><div class="text-right"><p class="font-bold text-gray-800 text-sm">${value.toLocaleString()}ì›</p></div>`;
                holdingsDiv.appendChild(div);
            });
            const total = userPortfolio.cash + stockValuation;
            const profit = total - 50000000;
            const profitRate = (profit / 50000000) * 100;
            document.getElementById('cash-balance').innerText = Math.round(userPortfolio.cash).toLocaleString();
            document.getElementById('total-asset').innerText = Math.round(total).toLocaleString();
            const profitEl = document.getElementById('total-profit');
            profitEl.innerText = `${Math.round(profit).toLocaleString()} (${profitRate.toFixed(2)}%)`;
            profitEl.className = profit >= 0 ? "text-lg font-semibold price-up" : "text-lg font-semibold price-down";
        }

        function updateNewsUI(newsList) {
            const ticker = document.getElementById('news-ticker');
            const list = document.getElementById('news-feed-list');
            if (newsList.length > 0) {
                const latest = newsList[0];
                let typeIcon = 'âšª [ì¼ë°˜]';
                if(latest.type === 'good') typeIcon = 'ğŸ”´ [í˜¸ì¬]';
                else if(latest.type === 'bad') typeIcon = 'ğŸ”µ [ì•…ì¬]';
                else if(latest.type === 'forecast') typeIcon = 'ğŸ”® [ì†ë³´]';

                ticker.innerText = `${typeIcon} ${latest.text} (${latest.time})`;
                
                if (window.lastNewsTime !== latest.time) {
                    if (latest.type === 'good') playSound('news_good');
                    else if (latest.type === 'bad') playSound('news_bad');
                    else if (latest.type === 'forecast') playSound('news_forecast'); 
                    else playSound('news_normal');
                    
                    window.lastNewsTime = latest.time;
                    ticker.parentElement.parentElement.classList.add('news-flash');
                    setTimeout(() => ticker.parentElement.parentElement.classList.remove('news-flash'), 1000);
                }

                list.innerHTML = '';
                // ğŸŸ¢ V30: ë‰´ìŠ¤ ë¦¬ìŠ¤íŠ¸ 10ê°œê¹Œì§€ í‘œì‹œ
                newsList.slice(0, 10).forEach(news => {
                    let icon = 'âšª';
                    let colorClass = "";
                    let cursorClass = "";
                    let clickEvent = "";

                    if(news.type === 'good') { icon = 'ğŸ”´'; colorClass = "text-red-600"; }
                    else if(news.type === 'bad') { icon = 'ğŸ”µ'; colorClass = "text-blue-600"; }
                    else if(news.type === 'forecast') { 
                        icon = 'ğŸ“°'; 
                        colorClass = "text-indigo-700 font-bold underline"; 
                        cursorClass = "cursor-pointer hover:bg-indigo-50"; 
                        // ğŸŸ¢ ê¸°ì‚¬ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
                        clickEvent = `onclick="openArticleModal('${news.fullTitle || news.text}', '${news.fullContent || ''}', '${news.time}')"`;
                    }

                    const div = document.createElement('div');
                    div.className = `p-3 border-b border-gray-100 last:border-0 transition rounded-lg ${cursorClass}`;
                    if(clickEvent) div.setAttribute('onclick', clickEvent.replace('onclick="', '').replace('"', '')); // setAttributeê°€ ì•ˆì „

                    div.innerHTML = `
                        <div class="flex justify-between text-xs text-gray-400 mb-1">
                            <span>${news.time}</span>
                            ${news.type === 'forecast' ? '<span class="text-indigo-500 font-bold">Click!</span>' : ''}
                        </div>
                        <div class="flex items-start">
                            <span class="mr-2 text-lg">${icon}</span>
                            <span class="${colorClass} text-sm leading-snug">${news.text}</span>
                        </div>
                    `;
                    // forecast íƒ€ì…ì¼ ë•Œë§Œ í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”© (HTML string ë°©ì‹ ëŒ€ì‹  addEventListener ì‚¬ìš©)
                    if(news.type === 'forecast') {
                        div.onclick = () => openArticleModal(news.fullTitle || news.text, news.fullContent, news.time);
                    }
                    
                    list.appendChild(div);
                });
            }
        }

        // ğŸŸ¢ V30: ê¸°ì‚¬ ì „ë¬¸ ëª¨ë‹¬ ì œì–´ í•¨ìˆ˜
        window.openArticleModal = (title, content, time) => {
            if(!content) return; // ë‚´ìš© ì—†ìœ¼ë©´ ì•ˆ ì—¼
            document.getElementById('article-title').innerText = title;
            document.getElementById('article-content').innerText = content;
            document.getElementById('article-time').innerText = time + " ì†ë³´";
            document.getElementById('article-modal').classList.remove('hidden');
        };

        window.closeArticleModal = () => {
            document.getElementById('article-modal').classList.add('hidden');
        };

        window.openBigRanking = async () => {
            const modal = document.getElementById('big-ranking-modal');
            const listEl = document.getElementById('big-ranking-list');
            modal.classList.remove('hidden');
            listEl.innerHTML = '<tr><td colspan="3" class="p-10 text-center text-gray-400 animate-pulse">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>';
            try {
                const q = query(collection(db, `artifacts/${appId}/users`));
                const snapshot = await getDocs(q);
                const allUsers = [];
                snapshot.forEach(doc => { allUsers.push(doc.data()); });
                const rankedUsers = allUsers.map(user => {
                    let stockVal = 0;
                    if (user.holdings) {
                        Object.keys(user.holdings).forEach(code => {
                            const price = marketData[code]?.price || 0;
                            stockVal += user.holdings[code].quantity * price;
                        });
                    }
                    return { name: user.name, total: (user.cash || 0) + stockVal };
                });
                rankedUsers.sort((a, b) => b.total - a.total);
                let html = '';
                rankedUsers.slice(0, 50).forEach((u, index) => { 
                    const rank = index + 1;
                    let rankStyle = "text-gray-600";
                    let rowBg = "hover:bg-gray-50";
                    let icon = "";
                    if(rank === 1) { rankStyle = "text-yellow-500 text-3xl"; rowBg = "bg-yellow-50 hover:bg-yellow-100"; icon = "ğŸ¥‡"; }
                    else if(rank === 2) { rankStyle = "text-gray-500 text-3xl"; rowBg = "bg-gray-50 hover:bg-gray-100"; icon = "ğŸ¥ˆ"; }
                    else if(rank === 3) { rankStyle = "text-orange-600 text-3xl"; rowBg = "bg-orange-50 hover:bg-orange-100"; icon = "ğŸ¥‰"; }
                    html += `<tr class="border-b border-gray-100 transition ${rowBg}"><td class="p-4 ${rankStyle} font-black">${icon} ${rank}ìœ„</td><td class="p-4 font-bold text-gray-800">${u.name}</td><td class="p-4 text-right font-mono text-indigo-600">${Math.round(u.total).toLocaleString()} ì›</td></tr>`;
                });
                listEl.innerHTML = html;
            } catch (e) {
                console.error(e);
                listEl.innerHTML = `<tr><td colspan="3" class="p-10 text-center text-red-500">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${e.message}</td></tr>`;
            }
        };

        window.closeBigRanking = () => {
            document.getElementById('big-ranking-modal').classList.add('hidden');
        };

        document.getElementById('login-btn').addEventListener('click', login);
    </script>
</body>
</html>
